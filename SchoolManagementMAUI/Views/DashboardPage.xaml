<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SchoolManagementMAUI.ViewModels"
             xmlns:shell="clr-namespace:Microsoft.Maui.Controls;assembly=Microsoft.Maui.Controls"
             x:Class="SchoolManagementMAUI.Views.DashboardPage"
             Title="Dashboard">

    <!-- TitleView com sineta e badge ao lado -->
    <shell:Shell.TitleView>
        <Grid ColumnDefinitions="*,Auto" Padding="10,0" HeightRequest="44">
            <Label Text="Dashboard"
                   VerticalOptions="Center"
                   FontAttributes="Bold"
                   FontSize="20" />

            <Grid Grid.Column="1" VerticalOptions="Center">
                <Grid ColumnDefinitions="Auto,16,Auto" VerticalOptions="Center">
                    <!-- Sino com badge -->
                    <Grid>
                        <Image Source="icon_bell.svg"
                               WidthRequest="24" HeightRequest="24">
                            <Image.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenAlertsCommand}" />
                            </Image.GestureRecognizers>
                        </Image>
                        <Frame IsVisible="{Binding HasUnreadAlerts}"
                               BackgroundColor="{StaticResource EducationalRed}"
                               WidthRequest="16" HeightRequest="16"
                               CornerRadius="8" Padding="0"
                               HasShadow="False"
                               HorizontalOptions="End" VerticalOptions="Start"
                               TranslationX="8" TranslationY="-6">
                            <Label Text="{Binding UnreadAlertsCount}"
                                   FontSize="10" FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center" VerticalOptions="Center" />
                        </Frame>
                    </Grid>

                    <BoxView Grid.Column="1" WidthRequest="16" Opacity="0" />

                    <!-- Ícone utilizador -->
                    <Image Grid.Column="2" Source="icon_user.svg"
                           WidthRequest="24" HeightRequest="24">
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding OpenProfileCommand}" />
                        </Image.GestureRecognizers>
                    </Image>
                </Grid>
            </Grid>
        </Grid>
    </shell:Shell.TitleView>
    
    <Grid>
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="20">
                <!-- Header com informações do utilizador -->
                <Frame Style="{StaticResource EducationalHeaderFrame}">
                    <VerticalStackLayout Spacing="15" HorizontalOptions="Center">
                        <Label Text="Welcome!" Style="{StaticResource EducationalWelcomeHeader}" />

                        <!-- Image profile -->
                        <Frame IsVisible="{Binding UserProfileImageUrl, Converter={StaticResource StringNotEmptyConverter}}"
                               CornerRadius="50" 
                               WidthRequest="100" 
                               HeightRequest="100" 
                               HorizontalOptions="Center"
                               Padding="0"
                               BackgroundColor="White">
                            <Image Source="{Binding UserProfileImageUrl}" 
                                   Aspect="AspectFill" />
                        </Frame>

                        <!-- Info User -->
                        <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                            <Label Text="{Binding UserName}" 
                                   Style="{StaticResource EducationalProfileName}"
                                   HorizontalOptions="Center" />

                            <Label Text="{Binding UserEmail}" 
                                   Style="{StaticResource EducationalProfileEmail}"
                                   HorizontalOptions="Center" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Action Buttons -->
                <VerticalStackLayout Spacing="15">
                    <Button Text="My Grades" Command="{Binding OpenGradesCommand}" 
                            Style="{StaticResource EducationalPrimaryButton}" />

                    <Button Text="Request Additional Subjects" Command="{Binding OpenEnrollmentRequestsCommand}" 
                            Style="{StaticResource EducationalPrimaryButton}"
                            BackgroundColor="{StaticResource EducationalGreen}" />
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        
    </Grid>

</ContentPage>