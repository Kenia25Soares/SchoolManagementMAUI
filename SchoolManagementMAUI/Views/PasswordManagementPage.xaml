<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SchoolManagementMAUI.Views.PasswordManagementPage"
             Title="Recover Password"
             BackgroundColor="White">


    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="30">

            <!-- Header -->
            <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                <Label Text="Recover Password" 
                       FontSize="24" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />
                <Label Text="Enter your email to receive a verification code" 
                       FontSize="14" 
                       TextColor="Gray" 
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <!-- Step 1: Email Input -->
            <VerticalStackLayout Spacing="15" Padding="20" BackgroundColor="#F8F9FA" IsVisible="{Binding IsStep1}">
                <Label Text="Enter your email" 
                       FontSize="18" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />

                <!-- Email Input -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Email" FontSize="14" FontAttributes="Bold" />
                    <Entry Placeholder="Enter your email" 
                           Text="{Binding Email}" 
                           Keyboard="Email"
                           TextColor="Black" />
                </VerticalStackLayout>

                <!-- Send Code Button -->
                <Button Text="Send Code" 
                        Command="{Binding SendCodeCommand}"
                        IsEnabled="{Binding CanSendCode}"
                        BackgroundColor="#007AFF"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="45" />

                <!-- Loading Indicator -->
                <ActivityIndicator IsVisible="{Binding IsSendingCode}"
                                 IsRunning="{Binding IsSendingCode}"
                                 Color="#007AFF"
                                 HorizontalOptions="Center" />

                <!-- Message -->
                <Label Text="{Binding Message}" 
                       IsVisible="{Binding HasMessage}"
                       TextColor="{Binding MessageColor}"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <!-- Step 2: Code Verification -->
            <VerticalStackLayout Spacing="15" Padding="20" BackgroundColor="#F8F9FA" IsVisible="{Binding IsStep2}">
                <Label Text="Enter the code" 
                       FontSize="18" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />

                <Label Text="Check your email and enter the received code" 
                       FontSize="12" 
                       TextColor="Gray" 
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center" />

                <!-- Code Input -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Verification Code" FontSize="14" FontAttributes="Bold" />
                    <Entry Placeholder="Enter the code" 
                           Text="{Binding VerificationCode}" 
                           Keyboard="Numeric"
                           TextColor="Black" />
                </VerticalStackLayout>

                <!-- Verify Code Button -->
                <Button Text="Verify Code" 
                        Command="{Binding VerifyCodeCommand}"
                        IsEnabled="{Binding CanVerifyCode}"
                        BackgroundColor="#28A745"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="45" />

                <!-- Resend Code Button -->
                <Button Text="Resend Code" 
                        Command="{Binding ResendCodeCommand}"
                        BackgroundColor="Transparent"
                        TextColor="#007AFF"
                        BorderColor="#007AFF"
                        BorderWidth="1"
                        CornerRadius="8"
                        HeightRequest="40" />

                <!-- Loading Indicator -->
                <ActivityIndicator IsVisible="{Binding IsVerifyingCode}"
                                 IsRunning="{Binding IsVerifyingCode}"
                                 Color="#28A745"
                                 HorizontalOptions="Center" />

                <!-- Message -->
                <Label Text="{Binding Message}" 
                       IsVisible="{Binding HasMessage}"
                       TextColor="{Binding MessageColor}"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <!-- Step 3: New Password -->
            <VerticalStackLayout Spacing="15" Padding="20" BackgroundColor="#F8F9FA" IsVisible="{Binding IsStep3}">
                <Label Text="New Password" 
                       FontSize="18" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />

                <Label Text="Enter your new password" 
                       FontSize="12" 
                       TextColor="Gray" 
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center" />

                <!-- New Password -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="New Password" FontSize="14" FontAttributes="Bold" />
                    <Entry Placeholder="Enter the new password" 
                           Text="{Binding NewPassword}" 
                           IsPassword="True"
                           TextColor="Black" />
                </VerticalStackLayout>

                <!-- Confirm New Password -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Confirm New Password" FontSize="14" FontAttributes="Bold" />
                    <Entry Placeholder="Confirm the new password" 
                           Text="{Binding ConfirmPassword}" 
                           IsPassword="True"
                           TextColor="Black" />
                </VerticalStackLayout>

                <!-- Reset Password Button -->
                <Button Text="Change Password" 
                        Command="{Binding ResetPasswordCommand}"
                        IsEnabled="{Binding CanResetPassword}"
                        BackgroundColor="#DC3545"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="45" />

                <!-- Loading Indicator -->
                <ActivityIndicator IsVisible="{Binding IsResettingPassword}"
                                 IsRunning="{Binding IsResettingPassword}"
                                 Color="#DC3545"
                                 HorizontalOptions="Center" />

                <!-- Message -->
                <Label Text="{Binding Message}" 
                       IsVisible="{Binding HasMessage}"
                       TextColor="{Binding MessageColor}"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <!-- Back to Login -->
            <Button Text="Back to Login" 
                    Command="{Binding GoBackCommand}"
                    BackgroundColor="Transparent"
                    TextColor="#007AFF"
                    BorderColor="#007AFF"
                    BorderWidth="1"
                    CornerRadius="8"
                    HeightRequest="50" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>